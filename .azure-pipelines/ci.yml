steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(PYTHON_VERSION)'
  displayName: 'Use Python $(PYTHON_VERSION)'

- script: |
    printf 'Waiting for MySQL database to accept connections'
    until mysql --host=127.0.0.1 --user=root --password=superSecret123 --execute "SHOW DATABASES"; do
      printf '.'
      sleep 1;
    done;
  displayName: Wait for database to initialise

- script: |
    mysql --host=127.0.0.1 --user=root --password=superSecret123 --execute "SHOW DATABASES;"
#    mysql -u root -e "CREATE DATABASE ispybtest; SET GLOBAL log_bin_trust_function_creators=ON;"
  displayName: Show databases

#- script: |
#    wget -t 3 -w 60 --random-wait https://github.com/DiamondLightSource/ispyb-database/releases/download/v1.17.2/ispyb-database-1.17.2.tar.gz
#    tar xvfz ispyb-database-1.17.2.tar.gz
#    mysql_upgrade -u root
#    mysql -u root -e "CREATE DATABASE ispybtest; SET GLOBAL log_bin_trust_function_creators=ON;"
#    mysql -u root -D ispybtest < schemas/ispyb/tables.sql
#    mysql -u root -D ispybtest < schemas/ispyb/lookups.sql
#    mysql -u root -D ispybtest < schemas/ispyb/data.sql
#    mysql -u root -D ispybtest < schemas/ispyb/routines.sql
#    mysql -u root -D ispybtest < grants/ispyb_processing.sql
#    mysql -u root -D ispybtest < grants/ispyb_import.sql
#    mysql -u root -e "CREATE USER ispyb_api@'localhost' IDENTIFIED BY 'password_1234'; GRANT ispyb_processing to ispyb_api@'localhost'; GRANT ispyb_import to ispyb_api@'localhost'; SET DEFAULT ROLE ispyb_processing FOR ispyb_api@'localhost';"
#    mysql -u root -e "CREATE USER ispyb_api_future@'localhost' IDENTIFIED BY 'password_4321'; GRANT SELECT ON ispybtest.* to ispyb_api_future@'localhost';"
#
#- script: |
#    python -m pip install --upgrade pip
#    pip install tox
#  displayName: "Set up tox"
#
#- script: |
#    tox -e azure
#  displayName: "Run tests"
#
#- task: PublishTestResults@2
#  condition: succeededOrFailed()
#  inputs:
#    testResultsFiles: '**/test-*.xml'
#    testRunTitle: 'Publish test results for Python $(PYTHON_VERSION)'
